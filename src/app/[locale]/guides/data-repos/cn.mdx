import {DescriptionList, Description} from '@/components/DescriptionList'

export const metadata = {
  title: '个人数据存储库',
  description:
    'AT 协议存储库结构指南。',
}

# 数据存储库

数据存储库是由单个用户发布的数据集合。存储库是自验证数据结构，这意味着每次更新都会被签名，并且可以被任何人验证。

它们在[存储库规范](/specs/repository)中有更深入的描述。

## 数据布局

存储库的内容以 [Merkle Search Tree (MST)](https://hal.inria.fr/hal-02303490/document) 形式布局，它将状态简化为单个根哈希。可以将其可视化为以下布局：


```
┌────────────────┐
│     Commit     │  (Signed Root)
└───────┬────────┘
        ↓
┌────────────────┐
│   Tree Nodes   │
└───────┬────────┘
        ↓
┌────────────────┐
│     Record     │
└────────────────┘
```

每个节点都是一个 [IPLD](https://ipld.io/) 对象 ([dag-cbor](https://ipld.io/docs/codecs/known/dag-cbor/))，它通过 [CID](https://github.com/multiformats/cid) 哈希来引用。上图中的箭头表示 CID 引用。

这种布局反映在 [AT URIs](/specs/at-uri-scheme) 中：

```
Root       | at://alice.com
Collection | at://alice.com/app.bsky.feed.post
Record     | at://alice.com/app.bsky.feed.post/1234
```

数据存储库的“提交”只是对根节点的 CID 的密钥对签名。对存储库的每次更改都会生成一个新的提交节点。

## 标识符类型

个人数据存储库中使用多种类型的标识符。

<DescriptionList>
  <Description title="DIDs"><a href="https://w3c.github.io/did/">Decentralized IDs (DIDs)</a> identify data repositories. They are broadly used as user IDs, but since every user has one data repository then a DID can be considered a reference to a data repository. The format of a DID varies by the “DID method” used but all DIDs ultimately resolve to a keypair and a list of service providers. This keypair can sign commits to the data repository.</Description>
  <Description title="CIDs"><a href="https://github.com/multiformats/cid">Content IDs (CIDs)</a> identify content using a fingerprint hash. They are used throughout the repository to reference the objects (nodes) within it. When a node in the repository changes, its CID also changes. Parents which reference the node must then update their reference, which in turn changes the parent’s CID as well. This chains all the way to the Commit node, which is then signed.</Description>
  <Description title="NSIDs"><a href="/specs/nsid">Namespaced Identifiers (NSIDs)</a> identify the Lexicon type for groups of records within a repository.</Description>
  <Description title="rkey"><a href="/specs/record-key">Record Keys</a> ("rkeys") identify individual records within a collection in a given repository. The format is specified by the collection Lexicon, with some collections having only a single record with a key like "self", and other collections having many records, with keys using a base32-encoded timestamp called a Timestamp Identifier (TID).</Description>
</DescriptionList>